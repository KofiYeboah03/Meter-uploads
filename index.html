<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FOC Meter Data Collection</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Initialize Supabase client
    const SUPABASE_URL = 'https://lzltmmfwwaqbkaovjpol.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx6bHRtbWZ3d2FxYmthb3ZqcG9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3ODc5OTYsImV4cCI6MjA4MTM2Mzk5Nn0.rYnsIiCTt7YuC4pfgaenpuz2DOUgYScwAVxCDc3jzsg';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const MAX_ENTRIES = 25;

    // Icon components
    const User = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
      </svg>
    );
    
    const Search = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
    );

    const Save = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
      </svg>
    );

    const Download = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
      </svg>
    );

    const Trash2 = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
    );

    const Loader = ({ className }) => (
      <svg className={className} fill="none" viewBox="0 0 24 24">
        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    );

    const RefreshCw = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg>
    );

    const AlertCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    const FOCDataEntry = () => {
      const [replacementData, setReplacementData] = useState([]);
      const [processedMeters, setProcessedMeters] = useState([]);
      const [currentMeterData, setCurrentMeterData] = useState(null);
      const [isLoading, setIsLoading] = useState(false);
      const [isSaving, setIsSaving] = useState(false);
      const [oldMeterNumber, setOldMeterNumber] = useState('');
      const [userId, setUserId] = useState('');
      const [userName, setUserName] = useState('');
      const [isLoggedIn, setIsLoggedIn] = useState(false);

      useEffect(() => {
        const savedUserId = localStorage.getItem('foc_user_id');
        const savedUserName = localStorage.getItem('foc_user_name');
        
        if (savedUserId && savedUserName) {
          setUserId(savedUserId);
          setUserName(savedUserName);
          setIsLoggedIn(true);
        }
      }, []);

      useEffect(() => {
        if (isLoggedIn) {
          loadFromSupabase();
        }
      }, [isLoggedIn]);

      const handleLogin = () => {
        const name = prompt('Enter your name/FOC identifier:');
        if (name && name.trim()) {
          const trimmedName = name.trim();
          const generatedId = `foc_${trimmedName.toLowerCase().replace(/\s+/g, '_')}_${Date.now()}`;
          
          setUserId(generatedId);
          setUserName(trimmedName);
          setIsLoggedIn(true);
          
          localStorage.setItem('foc_user_id', generatedId);
          localStorage.setItem('foc_user_name', trimmedName);
        }
      };

      const handleLogout = () => {
        if (window.confirm('Are you sure you want to logout? Your unsaved work will remain in the system.')) {
          localStorage.removeItem('foc_user_id');
          localStorage.removeItem('foc_user_name');
          setUserId('');
          setUserName('');
          setIsLoggedIn(false);
          setProcessedMeters([]);
          setCurrentMeterData(null);
          clearForm();
        }
      };

      const loadFromSupabase = async () => {
        setIsLoading(true);
        try {
          let allOrders = [];
          let from = 0;
          const batchSize = 1000;
          let hasMore = true;

          while (hasMore) {
            const { data: ordersData, error: ordersError } = await supabase
              .from('replacement_orders')
              .select('*')
              .order('uploaded_at', { ascending: false })
              .range(from, from + batchSize - 1);

            if (ordersError) throw ordersError;

            if (ordersData && ordersData.length > 0) {
              allOrders = [...allOrders, ...ordersData];
              from += batchSize;
              hasMore = ordersData.length === batchSize;
            } else {
              hasMore = false;
            }
          }

          setReplacementData(allOrders);
          
          const { data: metersData, error: metersError } = await supabase
            .from('processed_meters')
            .select('*')
            .eq('user_id', userId)
            .order('created_at', { ascending: false });

          if (metersError) throw metersError;

          setProcessedMeters(metersData || []);
        } catch (error) {
          console.error('Error loading from Supabase:', error);
          alert('Error loading data from database. Please check your internet connection.');
        } finally {
          setIsLoading(false);
        }
      };

      const lookupMeter = () => {
        if (!oldMeterNumber.trim()) {
          alert('Please enter an old meter number');
          return;
        }

        if (replacementData.length === 0) {
          alert('No replacement orders found. Please contact admin.');
          return;
        }

        const meterData = replacementData.find(row => {
          const oldMeter = row.old_meter_number;
          return oldMeter && oldMeter.toString().trim().toUpperCase() === oldMeterNumber.toUpperCase();
        });

        if (!meterData) {
          const partialMatch = replacementData.find(row => {
            const oldMeter = row.old_meter_number;
            return oldMeter && oldMeter.toString().trim().toUpperCase().includes(oldMeterNumber.toUpperCase());
          });
          
          if (partialMatch) {
            setCurrentMeterData(partialMatch);
          } else {
            alert(`Meter "${oldMeterNumber}" not found in replacement orders.`);
          }
        } else {
          setCurrentMeterData(meterData);
        }
      };

      const addToDataset = async () => {
        if (!currentMeterData) {
          alert('Please lookup a meter first');
          return;
        }

        if (processedMeters.length >= MAX_ENTRIES) {
          alert(`You have reached the maximum limit of ${MAX_ENTRIES} entries. Please export your data and start fresh.`);
          return;
        }

        setIsSaving(true);

        try {
          const processedMeter = {
            user_id: userId,
            user_name: userName,
            order_data: currentMeterData,
            created_at: new Date().toISOString()
          };

          const { data, error } = await supabase
            .from('processed_meters')
            .insert([processedMeter])
            .select();

          if (error) throw error;

          setProcessedMeters([data[0], ...processedMeters]);
          
          clearForm();
          alert(`Meter added successfully! (${processedMeters.length + 1}/${MAX_ENTRIES})`);
        } catch (error) {
          console.error('Error saving to Supabase:', error);
          alert(`Error saving data: ${error.message}`);
        } finally {
          setIsSaving(false);
        }
      };

      const clearForm = () => {
        setOldMeterNumber('');
        setCurrentMeterData(null);
      };

      const clearDataset = async () => {
        if (processedMeters.length === 0) {
          alert('Dataset is already empty');
          return;
        }
        
        if (window.confirm('Are you sure you want to clear the entire dataset? This will delete all data from the cloud.')) {
          try {
            const { data: userRecords, error: fetchError } = await supabase
              .from('processed_meters')
              .select('id')
              .eq('user_id', userId);

            if (fetchError) throw fetchError;

            if (userRecords && userRecords.length > 0) {
              const ids = userRecords.map(record => record.id);
              const { error: deleteError } = await supabase
                .from('processed_meters')
                .delete()
                .in('id', ids);

              if (deleteError) throw deleteError;
            }

            setProcessedMeters([]);
            alert('Dataset cleared successfully!');
          } catch (error) {
            console.error('Clear dataset error:', error);
            alert(`Error clearing dataset: ${error.message}`);
          }
        }
      };

      const exportExcel = () => {
        if (processedMeters.length === 0) {
          alert('No data to export');
          return;
        }

        const headers = [
          'SN', 'CMS REGION CODE', 'DISTRICT CODE', 'SERVICE ORDER CODE', 'SERVICE ORDER TYPE',
          'SERVICE POINT NUMBER', 'CUSTOMER NAME', 'CUSTOMER PHONE', 'EMAIL', 'GEOCODE',
          'TARIFF CODE', 'METER PHASE', 'OLD METER NUMBER', 'REQUESTED METER PHASE', 'NEW METER NUMBER',
          'FAULT TYPE', 'DIGITAL ADDRESS', 'ORDER STATUS', 'RETIREMENT CODE', 'PREPAID SYNC METHOD',
          'PREPAID SYNC STATUS', 'CONTRACTOR CODE', 'AGENT CODE', 'DATE CREATED', 'DATE ASSIGNED',
          'DATE ASSIGNED TO FOC', 'ASSIGNED TO FOC BY', 'DATE STARTED', 'DATE RESOLVED', 'DATE APPROVED',
          'APPROVED BY', 'DATE COMPLETED', 'PRESET AMOUNT', 'Batch ID', 'Org ID',
          'COSEM Logical Device Name', 'MFG Serial Number', 'Customer Serial Number', 'Manufacturer', 'Model Type',
          'IP Address', 'GPRS Module Serial Number', 'Firmware Type', 'Firmware Version', 'LLS Secret',
          'HLS Secret', 'Authentication', 'Encryption Key', 'MAC', 'Badge ID',
          'BLANK', 'RE-ROUTING TYPE', 'UIU RELEASED', 'Meter Enclosures - Three Phase', 'Meter Enclosures - Single Phase',
          'Soft Al Binding Wire', '9m Wooden Pole', 'Stay equipment c/w Rod & plate, Bow, 2No. Brackets & 2No. Thimbles and M16 * 40mm bolts and nuts',
          'LV Stay Insulator', '50/25 bolted type Aluminium tap off clamp', 'Green/Blue Meter Seals', 'Tower Clips',
          'Wooden Stay block', 'Stay wire-7/4 SWG', 'LV Shackle Insulator- Porcelain (76mm height)', 'D Iron C/W Pin (99mm *120mm *6mm) Large',
          'Coachscrew Insulator (Wonpiece)', 'LV Insulating Tape', '50sq.mm Al bare conductor', '120 sq.mm Al bare conductor',
          'Bolt & Nut (m16 x 260)', '120/25 bolted type Aluminium tap off clamp', '16CU/25AL bi-metal ferrule compression type',
          '8m Wooden Pole', '2*25sq.mm PVC Al Cable', 'UIU Cable', '7mm Clip', 'Breaker',
          '35Cu/25Al Bi-Metallic tap off clamp', '70Cu/25Al Bi-Metallic tap off clamp', 'Undersized Cable(s)',
          'SL 7000 DTM with Enclosure, Rogoskwi Coils and Voltage Taps', 'I-Smart with Enclosure', 'Flexible Tube (Bury cables)',
          'Bolt, Nut and Washers', 'Bi-metal Lug (35sqmm)', 'Cable belt (Large)', '2x35sqmm AL PVC Cable',
          'Enclosure strap', 'Bandit Tape', 'Hexing meter complete with Metering cubicle'
        ];

        const data = [headers];
        
        processedMeters.forEach(meter => {
          const orderData = meter.order_data || {};
          data.push([
            orderData.sn || '',
            orderData.cms_region_code || '',
            orderData.district_code || '',
            orderData.service_order_code || '',
            orderData.service_order_type || '',
            orderData.service_point_number || '',
            orderData.customer_name || '',
            orderData.customer_phone || '',
            orderData.email || '',
            orderData.geocode || '',
            orderData.tariff_code || '',
            orderData.meter_phase || '',
            orderData.old_meter_number || '',
            orderData.requested_meter_phase || '',
            orderData.new_meter_number || '',
            orderData.fault_type || '',
            orderData.digital_address || '',
            orderData.order_status || '',
            orderData.retirement_code || '',
            orderData.prepaid_sync_method || '',
            orderData.prepaid_sync_status || '',
            orderData.contractor_code || '',
            orderData.agent_code || '',
            orderData.date_created || '',
            orderData.date_assigned || '',
            orderData.date_assigned_to_foc || '',
            orderData.assigned_to_foc_by || '',
            orderData.date_started || '',
            orderData.date_resolved || '',
            orderData.date_approved || '',
            orderData.approved_by || '',
            orderData.date_completed || '',
            orderData.preset_amount || '',
            orderData.batch_id || '',
            orderData.org_id || '',
            orderData.cosem_logical_device_name || '',
            orderData.mfg_serial_number || '',
            orderData.customer_serial_number || '',
            orderData.manufacturer || '',
            orderData.model_type || '',
            orderData.ip_address || '',
            orderData.gprs_module_serial_number || '',
            orderData.firmware_type || '',
            orderData.firmware_version || '',
            orderData.lls_secret || '',
            orderData.hls_secret || '',
            orderData.authentication || '',
            orderData.encryption_key || '',
            orderData.mac || '',
            orderData.badge_id || '',
            orderData.blank || '',
            orderData.re_routing_type || '',
            orderData.uiu_released || '',
            orderData.meter_enclosures_three_phase || '',
            orderData.meter_enclosures_single_phase || '',
            orderData.soft_al_binding_wire || '',
            orderData.wooden_pole_9m || '',
            orderData.stay_equipment || '',
            orderData.lv_stay_insulator || '',
            orderData.aluminium_tap_off_clamp_50_25 || '',
            orderData.meter_seals || '',
            orderData.tower_clips || '',
            orderData.wooden_stay_block || '',
            orderData.stay_wire || '',
            orderData.lv_shackle_insulator || '',
            orderData.d_iron || '',
            orderData.coachscrew_insulator || '',
            orderData.lv_insulating_tape || '',
            orderData.al_bare_conductor_50 || '',
            orderData.al_bare_conductor_120 || '',
            orderData.bolt_nut || '',
            orderData.aluminium_tap_off_clamp_120_25 || '',
            orderData.bi_metal_ferrule || '',
            orderData.wooden_pole_8m || '',
            orderData.pvc_al_cable_2x25 || '',
            orderData.uiu_cable || '',
            orderData.clip_7mm || '',
            orderData.breaker || '',
            orderData.bi_metallic_tap_off_clamp_35 || '',
            orderData.bi_metallic_tap_off_clamp_70 || '',
            orderData.undersized_cables || '',
            orderData.sl_7000_dtm || '',
            orderData.i_smart || '',
            orderData.flexible_tube || '',
            orderData.bolt_nut_washers || '',
            orderData.bi_metal_lug || '',
            orderData.cable_belt || '',
            orderData.pvc_al_cable_2x35 || '',
            orderData.enclosure_strap || '',
            orderData.bandit_tape || '',
            orderData.hexing_meter || ''
          ]);
        });

        const worksheet = XLSX.utils.aoa_to_sheet(data);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, 'Meters');
        XLSX.writeFile(workbook, `FOC_Meter_Data_${userName}_${new Date().toISOString().split('T')[0]}.xlsx`);
      };

      if (!isLoggedIn) {
        return (
          <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
            <div className="bg-white rounded-lg border border-gray-200 shadow-sm p-8 max-w-md w-full">
              <div className="text-center mb-8">
                <div className="w-16 h-16 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center">
                  <User className="w-8 h-8 text-blue-600" />
                </div>
                <h1 className="text-2xl font-semibold text-gray-800 mb-2">FOC Login</h1>
                <p className="text-sm text-gray-600">Enter your name to start recording meter data</p>
              </div>
              
              <button
                onClick={handleLogin}
                className="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-all text-base"
              >
                Login / Start Session
              </button>
              
              <div className="mt-6 text-center text-xs text-gray-500">
                <p>Your data will be saved separately from other FOCs</p>
              </div>
            </div>
          </div>
        );
      }

      if (isLoading) {
        return (
          <div className="min-h-screen bg-gray-50 flex items-center justify-center">
            <div className="text-center">
              <Loader className="w-12 h-12 animate-spin text-blue-600 mx-auto mb-4" />
              <p className="text-gray-700 text-lg font-medium">Loading data from cloud...</p>
            </div>
          </div>
        );
      }

      const remainingEntries = MAX_ENTRIES - processedMeters.length;

      return (
        <div className="min-h-screen bg-gray-50">
          <div className="bg-white border-b border-gray-200 px-6 py-4">
            <div className="flex justify-between items-center">
              <div>
                <h1 className="text-2xl font-semibold text-gray-800">FOC Retired Meter Reconciliation</h1>
                <p className="text-sm text-gray-500 mt-1">Replacement Service Orders</p>
              </div>
              <div className="flex items-center gap-4">
                <div className="flex items-center gap-2 text-gray-600 bg-gray-100 px-4 py-2 rounded-lg">
                  <User className="w-4 h-4" />
                  <span className="text-sm font-medium">{userName}</span>
                </div>
                <button
                  onClick={handleLogout}
                  className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition-all"
                >
                  Logout
                </button>
              </div>
            </div>
          </div>

          <div className="max-w-7xl mx-auto p-6">
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
              <div className="bg-white rounded-lg border border-gray-200 p-4">
                <div className="text-sm text-gray-500 mb-1">Total Orders</div>
                <div className="text-2xl font-bold text-gray-800">{replacementData.length}</div>
              </div>
              <div className="bg-white rounded-lg border border-gray-200 p-4">
                <div className="text-sm text-gray-500 mb-1">Processed</div>
                <div className="text-2xl font-bold text-green-600">{processedMeters.length}/{MAX_ENTRIES}</div>
              </div>
              <div className="bg-white rounded-lg border border-gray-200 p-4">
                <div className="text-sm text-gray-500 mb-1">Remaining</div>
                <div className={`text-2xl font-bold ${remainingEntries <= 5 ? 'text-red-600' : 'text-orange-600'}`}>
                  {remainingEntries}
                </div>
              </div>
              <div className="bg-white rounded-lg border border-gray-200 p-4">
                <button
                  onClick={loadFromSupabase}
                  className="flex items-center gap-2 text-blue-600 hover:text-blue-700 text-sm font-medium"
                >
                  <RefreshCw className="w-4 h-4" />
                  Refresh Data
                </button>
              </div>
            </div>

            {remainingEntries === 0 && (
              <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-start gap-3">
                <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
                <div>
                  <h3 className="text-sm font-semibold text-red-800 mb-1">Maximum Entries Reached</h3>
                  <p className="text-sm text-red-700">You have reached the maximum limit of {MAX_ENTRIES} entries. Please export your data and clear the dataset to continue.</p>
                </div>
              </div>
            )}

            <div className="bg-white rounded-lg border border-gray-200 shadow-sm p-6 space-y-6">
              <div className="border-b border-gray-200 pb-4 mb-4">
                <h2 className="text-lg font-semibold text-gray-800 mb-4">Meter Lookup</h2>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-xs font-medium text-gray-700 mb-1">Old Meter Number</label>
                    <input
                      type="text"
                      value={oldMeterNumber}
                      onChange={(e) => setOldMeterNumber(e.target.value)}
                      placeholder="Enter meter number"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-sm"
                      onKeyPress={(e) => e.key === 'Enter' && lookupMeter()}
                      disabled={remainingEntries === 0}
                    />
                  </div>

                  <div className="flex items-end">
                    <button
                      onClick={lookupMeter}
                      disabled={isLoading || remainingEntries === 0}
                      className="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      <Search className="w-4 h-4" />
                      Lookup Meter
                    </button>
                  </div>
                </div>
              </div>

              {currentMeterData && (
                <>
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                    <h3 className="text-sm font-semibold text-gray-800 mb-3">Order Details</h3>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3 text-xs">
                      <div><span className="text-gray-500">Service Point:</span> <span className="font-medium">{currentMeterData.service_point_number || 'N/A'}</span></div>
                      <div><span className="text-gray-500">Old Meter:</span> <span className="font-medium">{currentMeterData.old_meter_number || 'N/A'}</span></div>
                      <div><span className="text-gray-500">New Meter:</span> <span className="font-medium">{currentMeterData.new_meter_number || 'N/A'}</span></div>
                      <div><span className="text-gray-500">Customer:</span> <span className="font-medium">{currentMeterData.customer_name || 'N/A'}</span></div>
                      <div><span className="text-gray-500">Date Started:</span> <span className="font-medium">{currentMeterData.date_started || 'N/A'}</span></div>
                      <div><span className="text-gray-500">Fault Type:</span> <span className="font-medium">{currentMeterData.fault_type || 'N/A'}</span></div>
                      <div><span className="text-gray-500">Contractor:</span> <span className="font-medium">{currentMeterData.contractor_code || 'N/A'}</span></div>
                      <div><span className="text-gray-500">Order Status:</span> <span className="font-medium">{currentMeterData.order_status || 'N/A'}</span></div>
                      <div><span className="text-gray-500">Meter Phase:</span> <span className="font-medium">{currentMeterData.meter_phase || 'N/A'}</span></div>
                    </div>
                  </div>

                  <div className="flex gap-3 mt-6">
                    <button
                      onClick={addToDataset}
                      disabled={isSaving || remainingEntries === 0}
                      className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      {isSaving ? <Loader className="w-4 h-4 animate-spin" /> : <Save className="w-4 h-4" />}
                      {isSaving ? 'Saving...' : 'Add to Dataset'}
                    </button>
                    
                    <button
                      onClick={clearForm}
                      className="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg text-sm font-medium transition-all"
                    >
                      Clear
                    </button>
                  </div>
                </>
              )}

              {processedMeters.length > 0 && (
                <div className="border-t border-gray-200 pt-6 mt-6">
                  <div className="flex justify-between items-center mb-4">
                    <div>
                      <h2 className="text-lg font-semibold text-gray-800">Processed Meters</h2>
                      <p className="text-sm text-gray-500">Showing {processedMeters.length} of {MAX_ENTRIES} maximum entries</p>
                    </div>
                    
                    <div className="flex gap-3">
                      <button
                        onClick={exportExcel}
                        className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2"
                      >
                        <Download className="w-4 h-4" />
                        Export Excel
                      </button>
                      <button
                        onClick={clearDataset}
                        className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2"
                      >
                        <Trash2 className="w-4 h-4" />
                        Clear All
                      </button>
                    </div>
                  </div>

                  <div className="border border-gray-200 rounded-lg overflow-hidden">
                    <div className="overflow-x-auto">
                      <table className="w-full text-sm">
                        <thead className="bg-gray-50 border-b border-gray-200">
                          <tr>
                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase">Entry #</th>
                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase">Service Point</th>
                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase">Old Meter</th>
                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase">New Meter</th>
                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase">Customer</th>
                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase">Date</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {processedMeters.map((meter, index) => (
                            <tr key={meter.id || index} className="hover:bg-gray-50 transition-colors">
                              <td className="px-4 py-3 text-gray-600">{processedMeters.length - index}</td>
                              <td className="px-4 py-3 text-gray-800">{meter.order_data?.service_point_number || 'N/A'}</td>
                              <td className="px-4 py-3 text-gray-800 font-medium">{meter.order_data?.old_meter_number || 'N/A'}</td>
                              <td className="px-4 py-3 text-gray-800">{meter.order_data?.new_meter_number || 'N/A'}</td>
                              <td className="px-4 py-3 text-gray-600 text-xs">{meter.order_data?.customer_name || 'N/A'}</td>
                              <td className="px-4 py-3 text-gray-600 text-xs">{meter.order_data?.date_started || 'N/A'}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };
      
    ReactDOM.render(<FOCDataEntry />, document.getElementById('root'));
  </script>
</body>
</html>
