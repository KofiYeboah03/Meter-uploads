<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FOC Meter Data Collection</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Initialize Supabase client
    const SUPABASE_URL = 'https://lzltmmfwwaqbkaovjpol.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx6bHRtbWZ3d2FxYmthb3ZqcG9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3ODc5OTYsImV4cCI6MjA4MTM2Mzk5Nn0.rYnsIiCTt7YuC4pfgaenpuz2DOUgYScwAVxCDc3jzsg';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const User = ({ className }) => (
     <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
     </svg>
    );
    
    // Icon components
    const Search = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
    );

    const Save = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
      </svg>
    );

    const Download = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
      </svg>
    );

    const Trash2 = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
    );

    const AlertCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    const CheckCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    const Loader = ({ className }) => (
      <svg className={className} fill="none" viewBox="0 0 24 24">
        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    );

    const RefreshCw = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg>
    );

    const replacementReasons = {
      'RR001': 'Meter reversing',
      'RR002': 'Meter Damaged by Customer',
      'RR003': 'Difficult to read',
      'RR004': 'Defective Register',
      'RR005': 'Credit not Reducing',
      'RR006': 'No Credit Display',
      'RR007': 'Faulty Meter after analyzer test',
      'RR008': 'Date and Time Drift',
      'RR009': 'Faulty Battery',
      'RR010': 'Faulty Relay',
      'RR011': 'Frequent Tripping',
      'RR012': 'No Output Voltage',
      'RR013': 'Tampered Meter',
      'RR014': 'Error on meter (ie.3,7,4,10,13,16)',
      'RR015': 'Over Voltage',
      'RR016': 'under voltage',
      'RR017': 'Relay open',
      'RR018': 'Faulty Breaker',
      'RR019': 'Meter Beeping',
      'RR020': 'Faulty Automatic Billing Reset',
      'RR021': 'Loss of Memory Register',
      'RR022': 'Zero Consumption',
      'RR023': 'Blur / Defaced Screen',
      'RR024': 'Faulty Modem',
      'RR025': 'Wrong Meter Number Installed (SWAP)',
      'RR026': 'Meter Creeping',
      'RR027': 'Faulty User Interface Unit',
      'RR028': 'No Communication with Server',
      'RR029': 'Meter No. Name plate Different from No. in Meter Memory',
      'RR030': 'Meter stopped',
      'RR031': 'Burnt Meter Terminal',
      'RR032': 'Glass broken',
      'RR033': 'Obsolete meter',
      'RR034': 'No Rotor Movement',
      'RR035': 'Rotor Stops Intermittently',
      'RR036': 'Rotor Stops at Low Load',
      'RR037': 'Stolen Meter',
      'RR038': 'Screen Off',
      'RR039': 'Mass replacement',
      'RR040': 'No communication',
      'RR041': 'Suspected Faulty Meter',
      'RR042': 'Faulty Card Reader',
      'RR043': 'Meter Upgrade (Single Phase to Three Phase)',
      'RR044': 'Meter Downgrade (Three Phase to Single Phase)'
    };

    const contractorCodeToFOC = {
      'SP0026': 'THONY AJ',
      'SP0025': 'WENDYDAM', 
      'SP0024': 'EDEN-ROSAMART',
      'SP0023': 'NAKOBUA',
      'SP0022': 'JACKSON',
      'SP0021': 'YEGBE',
      'SP0020': 'WESTPOOL',
      'SP0019': 'OTUB',
      'SP0018': 'MEGAGIFY',
      'SP0017': 'MK CABLE',
      'SP0016': 'OHEMEN',
      'SP0015': 'SIR CHARLES',
      'SP0014': 'WEST VIDAM',
      'SP0013': 'NAADEEABLE',
      'SP0012': 'PRESTIGE',
      'SP0011': 'HIMK',
      'SP0010': 'NAADEEABLE',
      'SP0009': 'ANDYMARK',
      'SP0008': 'BERTH',
      'SP0007': 'IONIC',
      'SP0006': 'KOSMEN',
      'SP0005': 'MINYA',
      'SP0004': 'SIMVID',
      'SP0003': 'SIMVID'
    };

    const FOCDataEntry = () => {
    const [replacementData, setReplacementData] = useState([]);
    const [processedMeters, setProcessedMeters] = useState([]);
    const [currentMeterData, setCurrentMeterData] = useState(null);
    const [isLoading, setIsLoading] = useState(false);
    const [isSaving, setIsSaving] = useState(false);
  
    const [oldMeterNumber, setOldMeterNumber] = useState('');
    const [boxNumber, setBoxNumber] = useState('');
    const [differentMeterNumber, setDifferentMeterNumber] = useState('');
    const [yearOfMake, setYearOfMake] = useState('');
    const [manufacturer, setManufacturer] = useState('');
    const [finalReading, setFinalReading] = useState('');
    const [rating, setRating] = useState('');
    const [userId, setUserId] = useState('');
    const [userName, setUserName] = useState('');
    const [isLoggedIn, setIsLoggedIn] = useState(false);

      useEffect(() => {
    // Check if user is already logged in
    const savedUserId = localStorage.getItem('foc_user_id');
    const savedUserName = localStorage.getItem('foc_user_name');
    
    if (savedUserId && savedUserName) {
      setUserId(savedUserId);
      setUserName(savedUserName);
      setIsLoggedIn(true);
    }
  }, []);

  useEffect(() => {
    if (isLoggedIn) {
      loadFromSupabase();
    }
  }, [isLoggedIn]);

     
    const handleLogin = () => {
    const name = prompt('Enter your name/FOC identifier:');
    if (name && name.trim()) {
      const trimmedName = name.trim();
      const generatedId = `foc_${trimmedName.toLowerCase().replace(/\s+/g, '_')}_${Date.now()}`;
      
      setUserId(generatedId);
      setUserName(trimmedName);
      setIsLoggedIn(true);
      
      localStorage.setItem('foc_user_id', generatedId);
      localStorage.setItem('foc_user_name', trimmedName);
    }
  };

  const handleLogout = () => {
    if (window.confirm('Are you sure you want to logout? Your unsaved work will remain in the system.')) {
      localStorage.removeItem('foc_user_id');
      localStorage.removeItem('foc_user_name');
      setUserId('');
      setUserName('');
      setIsLoggedIn(false);
      setProcessedMeters([]);
      setCurrentMeterData(null);
      clearForm();
    }
  };

     const loadFromSupabase = async () => {
        setIsLoading(true);
        try {
          // Fetch all records by setting a high limit or using pagination
          let allOrders = [];
          let from = 0;
          const batchSize = 1000;
          let hasMore = true;

          while (hasMore) {
            const { data: ordersData, error: ordersError } = await supabase
              .from('replacement_orders')
              .select('*')
              .order('uploaded_at', { ascending: false })
              .range(from, from + batchSize - 1);

            if (ordersError) throw ordersError;

            if (ordersData && ordersData.length > 0) {
              allOrders = [...allOrders, ...ordersData];
              from += batchSize;
              hasMore = ordersData.length === batchSize;
            } else {
              hasMore = false;
            }
          }

          setReplacementData(allOrders);
          
 const { data: metersData, error: metersError } = await supabase
  .from('processed_meters')
  .select('*')
  .eq('user_id', userId)  // ← ADD THIS LINE
  .order('created_at', { ascending: false });

if (metersError) throw metersError;

setProcessedMeters(metersData || []);
        } catch (error) {
          console.error('Error loading from Supabase:', error);
          alert('Error loading data from database. Please check your internet connection.');
        } finally {
          setIsLoading(false);
        }
      };

      const lookupMeter = () => {
  if (!oldMeterNumber.trim()) {
    alert('Please enter an old meter number');
    return;
  }

  if (replacementData.length === 0) {
    alert('No replacement orders found. Please contact admin.');
    return;
  }

  // Exact match
  const meterData = replacementData.find(row => {
    const oldMeter = row.old_meter_number;
    return oldMeter && oldMeter.toString().trim().toUpperCase() === oldMeterNumber.toUpperCase();
  });

  // Partial match if exact not found
  if (!meterData) {
    const partialMatch = replacementData.find(row => {
      const oldMeter = row.old_meter_number;
      return oldMeter && oldMeter.toString().trim().toUpperCase().includes(oldMeterNumber.toUpperCase());
    });
    
    if (partialMatch) {
      setCurrentMeterData(partialMatch);
    } else {
      alert(`Meter "${oldMeterNumber}" not found in replacement orders.`);
    }
  } else {
    setCurrentMeterData(meterData);
  }
};

      const addToDataset = async () => {
  if (!currentMeterData) {
    alert('Please lookup a meter first');
    return;
  }

  setIsSaving(true);

  try {
    const meterPhase = currentMeterData.meter_phase || '';
    const phaseValue = meterPhase.includes('3') ? '3' : '1';
    
    const faultType = currentMeterData.fault_type || '';
    const reasonForRemoval = replacementReasons[faultType] || faultType || 'Faulty Meter';

    const contractorCode = currentMeterData.contractor_code || '';
    const focName = contractorCodeToFOC[contractorCode] || contractorCode || 'Unknown FOC';

    const processedMeter = {
    user_id: userId,        
    user_name: userName,     
    box_number: boxNumber || 'N/A',
    service_point_number: currentMeterData.service_point_number?.toString() || '',
    meter_number: currentMeterData.old_meter_number || '',
    different_meter_number: differentMeterNumber || '',
    ppm_cm: 'PPM',
    final_reading: finalReading || '',
    units: '-',
    ghc: '-',
    year_of_make: yearOfMake || '',
    manufacturer: manufacturer || '',
    uiu: '-',
    phase: phaseValue,
    enclosure: '',
    sim_card: '',
    cable_length: '',
    rating: rating || '',
    date_removed: currentMeterData.date_started || '',
    reason_for_removal: reasonForRemoval,
    breaker: '',
    foc: focName,
    created_at: new Date().toISOString()
 };

          const { data, error } = await supabase
            .from('processed_meters')
            .insert([processedMeter])
            .select();

          if (error) throw error;

          setProcessedMeters([data[0], ...processedMeters]);
          
          clearForm();
          alert('Meter added to dataset and saved to cloud successfully!');
        } catch (error) {
          console.error('Error saving to Supabase:', error);
          alert(`Error saving data: ${error.message}`);
        } finally {
          setIsSaving(false);
        }
      };

const clearForm = () => {
  setOldMeterNumber('');
  setBoxNumber('');
  setDifferentMeterNumber('');
  setYearOfMake('');
  setManufacturer('');
  setFinalReading('');
  setRating('');
  setCurrentMeterData(null);
};

      const clearDataset = async () => {
  if (processedMeters.length === 0) {
    alert('Dataset is already empty');
    return;
  }
  
  if (window.confirm('Are you sure you want to clear the entire dataset? This will delete all data from the cloud.')) {
    try {
      // Delete all records by getting all IDs and deleting them
const { data: userRecords, error: fetchError } = await supabase
  .from('processed_meters')
  .select('id')
  .eq('user_id', userId);  // ← ADD THIS LINE

if (fetchError) throw fetchError;

if (userRecords && userRecords.length > 0) {  // ← Change allRecords to userRecords
  const ids = userRecords.map(record => record.id);
        const { error: deleteError } = await supabase
          .from('processed_meters')
          .delete()
          .in('id', ids);  //

        if (deleteError) throw deleteError;
      }

      setProcessedMeters([]);
      alert('Dataset cleared successfully!');
    } catch (error) {
      console.error('Clear dataset error:', error);
      alert(`Error clearing dataset: ${error.message}`);
    }
  }
};

      const exportExcel = () => {
        if (processedMeters.length === 0) {
          alert('No data to export');
          return;
        }

const headers = [
  'BOX NO',
  'SERVICE POINT NUMBER',
  'METER NUMBER',
  'DIFFERENT METER NUMBER ON FIELD',
  'PPM / CM',
  'FINAL READING',
  'UNITS(kWh)',
  'GH¢',
  'YEAR OF MAKE',
  'MANUFACTURER',
  'USER INTERFACE UNIT (UIU)',
  'PHASE (1/3)',
  'ENCLOSURE',
  'SIM CARD',
  'CABLE LENGTH (M)',
  'RATING',
  'DATE METER REMOVED',
  'REASON FOR REMOVAL',
  'BREAKER',
  'F0C'
];

        const data = [headers];
        
processedMeters.forEach(meter => {
  data.push([
    meter.box_number,
    meter.service_point_number,
    meter.meter_number,
    meter.different_meter_number,
    meter.ppm_cm,
    meter.final_reading,
    meter.units,
    meter.ghc,
    meter.year_of_make,
    meter.manufacturer,
    meter.uiu,
    meter.phase,
    meter.enclosure,
    meter.sim_card,
    meter.cable_length,
    meter.rating,
    meter.date_removed,
    meter.reason_for_removal,
    meter.breaker,
    meter.foc
  ]);
});

        const worksheet = XLSX.utils.aoa_to_sheet(data);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, 'Meters');
        XLSX.writeFile(workbook, `FOC_Meter_Data_${userName}_${new Date().toISOString().split('T')[0]}.xlsx`);
      };

      // ADD THIS ENTIRE LOGIN SCREEN
  if (!isLoggedIn) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 flex items-center justify-center p-4">
        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
          <div className="text-center mb-8">
            <User className="w-20 h-20 mx-auto text-indigo-600 mb-4" />
            <h1 className="text-3xl font-bold text-gray-800 mb-2">FOC Login</h1>
            <p className="text-gray-600">Enter your name to start recording meter data</p>
          </div>
          
          <button
            onClick={handleLogin}
            className="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-4 rounded-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all text-lg"
          >
            Login / Start Session
          </button>
          
          <div className="mt-6 text-center text-sm text-gray-600">
            <p>Your data will be saved separately from other FOCs</p>
          </div>
        </div>
      </div>
    );
  }

      if (isLoading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 flex items-center justify-center">
            <div className="text-center">
              <Loader className="w-16 h-16 animate-spin text-white mx-auto mb-4" />
              <p className="text-white text-xl font-semibold">Loading data from cloud...</p>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 p-4">
          <div className="fixed inset-0 pointer-events-none overflow-hidden">
            {[...Array(15)].map((_, i) => (
              <div
                key={i}
                className="absolute w-2 h-2 bg-white rounded-full opacity-20 animate-pulse"
                style={{
                  left: `${Math.random() * 100}%`,
                  top: `${Math.random() * 100}%`,
                  animationDelay: `${Math.random() * 5}s`,
                  animationDuration: `${3 + Math.random() * 4}s`
                }}
              />
            ))}
          </div>

          <div className="max-w-6xl mx-auto relative z-10">
            <div className="bg-gradient-to-r from-slate-800 to-blue-900 rounded-t-3xl p-8 text-white shadow-2xl">
  <div className="flex justify-between items-center mb-4">
    <div>
      <h1 className="text-4xl font-bold mb-2">FOC Retired Meter Reconciliation</h1>
      <div className="flex items-center gap-2 text-blue-200">
        <User className="w-5 h-5" />
        <span className="text-lg">Logged in as: <strong>{userName}</strong></span>
      </div>
    </div>
    <button
      onClick={handleLogout}
      className="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg transition-all"
    >
      Logout
    </button>
  </div>
  
  <button
    onClick={loadFromSupabase}
    className="mt-4 flex items-center gap-2 bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-all"
  >
    <RefreshCw className="w-4 h-4" />
    Refresh My Data
  </button>
</div>

            <div className="bg-white/95 backdrop-blur-sm rounded-b-3xl shadow-2xl p-6 space-y-6">
              
              {replacementData.length > 0 ? (
                <div className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-6 border-l-4 border-green-500">
                  <div className="flex items-center gap-3">
                    <CheckCircle className="w-8 h-8 text-green-600" />
                    <div>
                      <h3 className="text-xl font-bold text-gray-800">Replacement Orders Loaded</h3>
                      <p className="text-gray-600">{replacementData.length} orders available from cloud database</p>
                    </div>
                  </div>
                </div>
              ) : (
                <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 border-l-4 border-amber-500">
                  <div className="flex items-center gap-3">
                    <AlertCircle className="w-8 h-8 text-amber-600" />
                    <div>
                      <h3 className="text-xl font-bold text-gray-800">No Orders Found</h3>
                      <p className="text-gray-600">Contact admin to upload replacement orders to the system</p>
                    </div>
                  </div>
                </div>
              )}

              <div className="bg-gradient-to-br from-gray-50 to-slate-50 rounded-2xl p-6 border-l-4 border-indigo-500">
                <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                  <Search className="w-6 h-6" />
                  Meter Data Entry
                </h2>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Old Meter Number *</label>
                    <input
                      type="text"
                      value={oldMeterNumber}
                      onChange={(e) => setOldMeterNumber(e.target.value)}
                      placeholder="Enter old meter number"
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                      onKeyPress={(e) => e.key === 'Enter' && lookupMeter()}
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Box Number</label>
                    <input
                      type="text"
                      value={boxNumber}
                      onChange={(e) => setBoxNumber(e.target.value)}
                      placeholder="Enter box number"
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                    />
                  </div>
                </div>

                <button
                  onClick={lookupMeter}
                  disabled={isLoading}
                  className="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <Search className="w-5 h-5" />
                  Lookup Meter Data
                </button>
              </div>

              {currentMeterData && (
                <>
                  <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-6 border-l-4 border-blue-500">
                    <h3 className="text-xl font-bold text-gray-800 mb-4">Found Meter Details</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                       <div><strong>Service Point:</strong> {currentMeterData.service_point_number || 'N/A'}</div>
                       <div><strong>Old Meter:</strong> {currentMeterData.old_meter_number || 'N/A'}</div>
                       <div><strong>Customer:</strong> {currentMeterData.customer_name || 'N/A'}</div>
                       <div><strong>Date Started:</strong> {currentMeterData.date_started || 'N/A'}</div>
                       <div><strong>Fault Type:</strong> {currentMeterData.fault_type || 'N/A'}</div>
                       <div><strong>Contractor:</strong> {currentMeterData.contractor_code || 'N/A'}</div>
                   </div>
                  </div>

 <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 border-l-4 border-amber-500">
  <h3 className="text-xl font-bold text-gray-800 mb-4">Additional Information</h3>
  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label className="block text-sm font-semibold text-gray-700 mb-2">Different Number on Field</label>
      <input
        type="text"
        value={differentMeterNumber}
        onChange={(e) => setDifferentMeterNumber(e.target.value)}
        placeholder="If different from old meter"
        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all"
      />
    </div>
    
    <div>
      <label className="block text-sm font-semibold text-gray-700 mb-2">Year of Make</label>
      <input
        type="number"
        value={yearOfMake}
        onChange={(e) => setYearOfMake(e.target.value)}
        placeholder="Enter year"
        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all"
      />
    </div>

    <div>
      <label className="block text-sm font-semibold text-gray-700 mb-2">Manufacturer</label>
      <input
        type="text"
        value={manufacturer}
        onChange={(e) => setManufacturer(e.target.value)}
        placeholder="Enter manufacturer"
        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all"
      />
    </div>

    <div>
      <label className="block text-sm font-semibold text-gray-700 mb-2">Final Reading</label>
      <input
        type="text"
        value={finalReading}
        onChange={(e) => setFinalReading(e.target.value)}
        placeholder="Enter final reading"
        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all"
      />
    </div>

    <div>
      <label className="block text-sm font-semibold text-gray-700 mb-2">Rating</label>
      <input
        type="text"
        value={rating}
        onChange={(e) => setRating(e.target.value)}
        placeholder="Enter rating"
        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all"
      />
    </div>
  </div>

                    <div className="flex gap-3 mt-6">
                      <button
                        onClick={addToDataset}
                        disabled={isSaving}
                        className="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                      >
                        {isSaving ? <Loader className="w-5 h-5 animate-spin" /> : <Save className="w-5 h-5" />}
                        {isSaving ? 'Saving...' : 'Add to Dataset'}
                      </button>
                      
                      <button
                        onClick={clearForm}
                        className="bg-gradient-to-r from-gray-400 to-gray-500 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all"
                      >
                        Clear Form
                      </button>
                    </div>
                  </div>
                </>
              )}

              {processedMeters.length > 0 && (
                <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-6 border-l-4 border-purple-500">
                  <h2 className="text-2xl font-bold text-gray-800 mb-4">Dataset Summary</h2>
                  
                  <div className="mb-4">
                    <div className="flex justify-between mb-2">
                      <span className="font-semibold">Total Meters Processed</span>
                      <span className="font-semibold">{processedMeters.length} meters</span>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                      <div 
                        className="bg-gradient-to-r from-purple-500 to-pink-500 h-full rounded-full transition-all duration-500"
                        style={{ width: `${Math.min((processedMeters.length / 25) * 100, 100)}%` }}
                      />
                    </div>
                  </div>

                  <div className="overflow-x-auto rounded-lg shadow max-h-96 overflow-y-auto">
                    <table className="w-full text-sm">
                      <thead className="bg-gradient-to-r from-purple-600 to-indigo-600 text-white sticky top-0">
                        <tr>
                          <th className="px-4 py-3 text-left">Box</th>
                          <th className="px-4 py-3 text-left">Service Point</th>
                          <th className="px-4 py-3 text-left">Meter</th>
                          <th className="px-4 py-3 text-left">Year</th>
                          <th className="px-4 py-3 text-left">FOC</th>
                        </tr>
                      </thead>
                      <tbody className="bg-white">
                        {processedMeters.map((meter, index) => (
                          <tr key={meter.id || index} className="border-b hover:bg-purple-50 transition-colors">
                            <td className="px-4 py-3">{meter.box_number}</td>
                            <td className="px-4 py-3">{meter.service_point_number}</td>
                            <td className="px-4 py-3">{meter.meter_number}</td>
                            <td className="px-4 py-3">{meter.year_of_make}</td>
                            <td className="px-4 py-3">{meter.foc}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>

                  <div className="flex gap-3 mt-6">
                    <button
                      onClick={exportExcel}
                      className="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all flex items-center gap-2"
                    >
                      <Download className="w-5 h-5" />
                      Export Excel
                    </button>
                    
                    <button
                      onClick={clearDataset}
                      className="bg-gradient-to-r from-red-500 to-rose-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all flex items-center gap-2"
                    >
                      <Trash2 className="w-5 h-5" />
                      Clear Dataset
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<FOCDataEntry />, document.getElementById('root'));
  </script>
</body>
</html>
